=== RUN   TestCreateQueueHandler
=== RUN   TestCreateQueueHandler/Successful_Standard_Queue_Creation
=== RUN   TestCreateQueueHandler/Successful_FIFO_Queue_Creation
    handlers_test.go:143: 
        	Error Trace:	/config/kiroku-core/apps/concreteq/handlers_test.go:143
        	Error:      	Not equal: 
        	            	expected: 201
        	            	actual  : 400
        	Test:       	TestCreateQueueHandler/Successful_FIFO_Queue_Creation
    handlers_test.go:160: 
        	Error Trace:	/config/kiroku-core/apps/concreteq/handlers_test.go:160
        	Error:      	Not equal: 
        	            	expected: models.ErrorResponse{Type:"", Message:""}
        	            	actual  : models.ErrorResponse{Type:"InvalidParameterValue", Message:"Invalid queue name: Can only include alphanumeric characters, hyphens, and underscores. 1 to 80 in length."}
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1,4 +1,4 @@
        	            	 (models.ErrorResponse) {
        	            	- Type: (string) "",
        	            	- Message: (string) ""
        	            	+ Type: (string) (len=21) "InvalidParameterValue",
        	            	+ Message: (string) (len=106) "Invalid queue name: Can only include alphanumeric characters, hyphens, and underscores. 1 to 80 in length."
        	            	 }
        	Test:       	TestCreateQueueHandler/Successful_FIFO_Queue_Creation
    handlers_test.go:167: FAIL:	CreateQueue(string,string,string,string)
        		at: [/config/kiroku-core/apps/concreteq/handlers_test.go:44 /config/kiroku-core/apps/concreteq/handlers_test.go:130]
    handlers_test.go:167: FAIL: 0 out of 1 expectation(s) were met.
        	The code you are testing needs to make 1 more call(s).
        	at: [/config/kiroku-core/apps/concreteq/handlers_test.go:167]
=== RUN   TestCreateQueueHandler/Queue_Name_Too_Long
=== RUN   TestCreateQueueHandler/Invalid_Characters_in_Queue_Name
=== RUN   TestCreateQueueHandler/FIFO_Name_without_FIFO_Attribute
    handlers_test.go:160: 
        	Error Trace:	/config/kiroku-core/apps/concreteq/handlers_test.go:160
        	Error:      	Not equal: 
        	            	expected: models.ErrorResponse{Type:"InvalidParameterValue", Message:"Queue name ends in .fifo but FifoQueue attribute is not 'true'"}
        	            	actual  : models.ErrorResponse{Type:"InvalidParameterValue", Message:"Invalid queue name: Can only include alphanumeric characters, hyphens, and underscores. 1 to 80 in length."}
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -2,3 +2,3 @@
        	            	  Type: (string) (len=21) "InvalidParameterValue",
        	            	- Message: (string) (len=62) "Queue name ends in .fifo but FifoQueue attribute is not 'true'"
        	            	+ Message: (string) (len=106) "Invalid queue name: Can only include alphanumeric characters, hyphens, and underscores. 1 to 80 in length."
        	            	 }
        	Test:       	TestCreateQueueHandler/FIFO_Name_without_FIFO_Attribute
=== RUN   TestCreateQueueHandler/FIFO_Attribute_without_FIFO_Name
=== RUN   TestCreateQueueHandler/Invalid_Attribute_Value
=== RUN   TestCreateQueueHandler/Invalid_Redrive_Policy_JSON
=== RUN   TestCreateQueueHandler/Invalid_Redrive_Policy_MaxReceiveCount
=== RUN   TestCreateQueueHandler/FIFO_Attribute_on_Standard_Queue
--- FAIL: TestCreateQueueHandler (0.00s)
    --- PASS: TestCreateQueueHandler/Successful_Standard_Queue_Creation (0.00s)
    --- FAIL: TestCreateQueueHandler/Successful_FIFO_Queue_Creation (0.00s)
    --- PASS: TestCreateQueueHandler/Queue_Name_Too_Long (0.00s)
    --- PASS: TestCreateQueueHandler/Invalid_Characters_in_Queue_Name (0.00s)
    --- FAIL: TestCreateQueueHandler/FIFO_Name_without_FIFO_Attribute (0.00s)
    --- PASS: TestCreateQueueHandler/FIFO_Attribute_without_FIFO_Name (0.00s)
    --- PASS: TestCreateQueueHandler/Invalid_Attribute_Value (0.00s)
    --- PASS: TestCreateQueueHandler/Invalid_Redrive_Policy_JSON (0.00s)
    --- PASS: TestCreateQueueHandler/Invalid_Redrive_Policy_MaxReceiveCount (0.00s)
    --- FAIL: TestCreateQueueHandler/FIFO_Attribute_on_Standard_Queue (0.00s)
panic: 
	assert: mock: I don't know what to return because the method call was unexpected.
		Either do Mock.On("CreateQueue").Return(...) first, or remove the CreateQueue() call.
		This method was unexpected:
			CreateQueue(*context.valueCtx,string,map[string]string,map[string]string)
			0: &context.valueCtx{Context:context.backgroundCtx{emptyCtx:context.emptyCtx{}}, key:(*chi.contextKey)(0xc31e30), val:(*chi.Context)(0xc0002092c0)}
			1: "standard-q"
			2: map[string]string{"DeduplicationScope":"messageGroup"}
			3: map[string]string(nil)
		at: [/config/kiroku-core/apps/concreteq/mock_store_test.go:21 /config/kiroku-core/apps/concreteq/server/server.go:557 /config/kiroku-core/apps/concreteq/server/server.go:65 /usr/lib/go-1.25/src/net/http/server.go:2322 /config/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.2/mux.go:478 /usr/lib/go-1.25/src/net/http/server.go:2322 /config/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.2/mux.go:90 /config/kiroku-core/apps/concreteq/handlers_test.go:141] [recovered, repanicked]

goroutine 18 [running]:
testing.tRunner.func1.2({0x846020, 0xc00020d480})
	/usr/lib/go-1.25/src/testing/testing.go:1872 +0x237
testing.tRunner.func1()
	/usr/lib/go-1.25/src/testing/testing.go:1875 +0x35b
panic({0x846020?, 0xc00020d480?})
	/usr/lib/go-1.25/src/runtime/panic.go:783 +0x132
github.com/stretchr/testify/mock.(*Mock).fail(0xc0000e1270, {0x90f4cc?, 0x8?}, {0xc00020f7c0?, 0x4?, 0x4?})
	/config/go/pkg/mod/github.com/stretchr/testify@v1.11.1/mock/mock.go:359 +0x125
github.com/stretchr/testify/mock.(*Mock).MethodCalled(0xc0000e1270, {0xa2722a, 0xb}, {0xc00020f680, 0x4, 0x4})
	/config/go/pkg/mod/github.com/stretchr/testify@v1.11.1/mock/mock.go:527 +0x77b
github.com/stretchr/testify/mock.(*Mock).Called(0xc0000e1270, {0xc00020f680, 0x4, 0x4})
	/config/go/pkg/mod/github.com/stretchr/testify@v1.11.1/mock/mock.go:491 +0x125
github.com/tabeth/concreteq.(*MockStore).CreateQueue(0xc0000e1270, {0x99dfe8, 0xc0002158c0}, {0xc0001def40, 0xa}, 0xc000215920, 0x0)
	/config/kiroku-core/apps/concreteq/mock_store_test.go:21 +0x145
github.com/tabeth/concreteq/server.(*App).CreateQueueHandler(0xc00020d090, {0x99da08, 0xc00020f640}, 0xc000213400)
	/config/kiroku-core/apps/concreteq/server/server.go:557 +0x558
github.com/tabeth/concreteq/server.(*App).RootSQSHandler(0xc00020d090, {0x99da08, 0xc00020f640}, 0xc000213400)
	/config/kiroku-core/apps/concreteq/server/server.go:65 +0x28e
net/http.HandlerFunc.ServeHTTP(0xc0002092c0?, {0x99da08?, 0xc00020f640?}, 0x99616c?)
	/usr/lib/go-1.25/src/net/http/server.go:2322 +0x29
github.com/go-chi/chi/v5.(*Mux).routeHTTP(0xc000040fc0, {0x99da08, 0xc00020f640}, 0xc000213400)
	/config/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.2/mux.go:478 +0x2e2
net/http.HandlerFunc.ServeHTTP(0x99df78?, {0x99da08?, 0xc00020f640?}, 0xc31e30?)
	/usr/lib/go-1.25/src/net/http/server.go:2322 +0x29
github.com/go-chi/chi/v5.(*Mux).ServeHTTP(0xc000040fc0, {0x99da08, 0xc00020f640}, 0xc0002132c0)
	/config/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.2/mux.go:90 +0x2ee
github.com/tabeth/concreteq.TestCreateQueueHandler.func13(0xc00022e000)
	/config/kiroku-core/apps/concreteq/handlers_test.go:141 +0x34b
testing.tRunner(0xc00022e000, 0xc0000e11d0)
	/usr/lib/go-1.25/src/testing/testing.go:1934 +0xea
created by testing.(*T).Run in goroutine 7
	/usr/lib/go-1.25/src/testing/testing.go:1997 +0x465
FAIL	github.com/tabeth/concreteq	0.012s
=== RUN   TestModels
--- PASS: TestModels (0.00s)
PASS
coverage: 0.0% of statements in ./...
ok  	github.com/tabeth/concreteq/models	0.008s	coverage: 0.0% of statements in ./...
	github.com/tabeth/concreteq/server		coverage: 0.0% of statements
=== RUN   TestBuildResponseAttributes
--- PASS: TestBuildResponseAttributes (0.00s)
=== RUN   TestBuildResponseMessageAttributes
--- PASS: TestBuildResponseMessageAttributes (0.00s)
=== RUN   TestHashAttributes
--- PASS: TestHashAttributes (0.00s)
=== RUN   TestFDBStore_NewFDBStore
Checking FoundationDB cluster availability...
FoundationDB cluster is available. Proceeding with tests.
--- PASS: TestFDBStore_NewFDBStore (0.01s)
=== RUN   TestFDBStore_GetQueueURL
=== RUN   TestFDBStore_GetQueueURL/returns_error_for_non-existent_queue
=== RUN   TestFDBStore_GetQueueURL/returns_success_for_existing_queue
--- PASS: TestFDBStore_GetQueueURL (0.02s)
    --- PASS: TestFDBStore_GetQueueURL/returns_error_for_non-existent_queue (0.00s)
    --- PASS: TestFDBStore_GetQueueURL/returns_success_for_existing_queue (0.01s)
=== RUN   TestFDBStore_ListDeadLetterSourceQueues
--- PASS: TestFDBStore_ListDeadLetterSourceQueues (0.05s)
=== RUN   TestHashSystemAttributes
--- PASS: TestHashSystemAttributes (0.00s)
=== RUN   TestFDBStore_ChangeMessageVisibility
--- PASS: TestFDBStore_ChangeMessageVisibility (1.23s)
=== RUN   TestFDBStore_ChangeMessageVisibilityBatch
--- PASS: TestFDBStore_ChangeMessageVisibilityBatch (1.24s)
=== RUN   TestFDBStore_DeleteMessageBatch_InvalidReceipt
--- PASS: TestFDBStore_DeleteMessageBatch_InvalidReceipt (0.01s)
=== RUN   TestFDBStore_ChangeMessageVisibility_NotInflight
--- PASS: TestFDBStore_ChangeMessageVisibility_NotInflight (0.01s)
=== RUN   TestFDBStore_DeleteMessageBatch_MessageNotFound
--- PASS: TestFDBStore_DeleteMessageBatch_MessageNotFound (0.02s)
=== RUN   TestFDBStore_CreateQueue
=== RUN   TestFDBStore_CreateQueue/creates_a_new_queue_successfully
=== RUN   TestFDBStore_CreateQueue/returns_attributes_if_queue_already_exists
=== RUN   TestFDBStore_CreateQueue/stores_attributes_and_tags_correctly
--- PASS: TestFDBStore_CreateQueue (0.02s)
    --- PASS: TestFDBStore_CreateQueue/creates_a_new_queue_successfully (0.00s)
    --- PASS: TestFDBStore_CreateQueue/returns_attributes_if_queue_already_exists (0.01s)
    --- PASS: TestFDBStore_CreateQueue/stores_attributes_and_tags_correctly (0.01s)
=== RUN   TestFDBStore_ListQueues
=== RUN   TestFDBStore_ListQueues/List_all_queues
=== RUN   TestFDBStore_ListQueues/List_with_MaxResults
=== RUN   TestFDBStore_ListQueues/List_with_QueueNamePrefix
=== RUN   TestFDBStore_ListQueues/Pagination
--- PASS: TestFDBStore_ListQueues (0.04s)
    --- PASS: TestFDBStore_ListQueues/List_all_queues (0.00s)
    --- PASS: TestFDBStore_ListQueues/List_with_MaxResults (0.00s)
    --- PASS: TestFDBStore_ListQueues/List_with_QueueNamePrefix (0.00s)
    --- PASS: TestFDBStore_ListQueues/Pagination (0.00s)
=== RUN   TestFDBStore_DeleteQueue
=== RUN   TestFDBStore_DeleteQueue/deletes_an_existing_queue
=== RUN   TestFDBStore_DeleteQueue/returns_error_for_non-existent_queue
=== RUN   TestFDBStore_DeleteQueue/deletes_a_queue_and_all_its_contents
--- PASS: TestFDBStore_DeleteQueue (0.03s)
    --- PASS: TestFDBStore_DeleteQueue/deletes_an_existing_queue (0.01s)
    --- PASS: TestFDBStore_DeleteQueue/returns_error_for_non-existent_queue (0.00s)
    --- PASS: TestFDBStore_DeleteQueue/deletes_a_queue_and_all_its_contents (0.02s)
=== RUN   TestFDBStore_SendMessageBatch
=== RUN   TestFDBStore_SendMessageBatch/sends_a_batch_successfully_to_a_standard_queue
=== RUN   TestFDBStore_SendMessageBatch/sends_a_batch_to_a_fifo_queue_with_deduplication
=== RUN   TestFDBStore_SendMessageBatch/returns_error_if_queue_does_not_exist
=== RUN   TestFDBStore_SendMessageBatch/handles_partial_failures_within_a_batch
--- PASS: TestFDBStore_SendMessageBatch (0.04s)
    --- PASS: TestFDBStore_SendMessageBatch/sends_a_batch_successfully_to_a_standard_queue (0.01s)
    --- PASS: TestFDBStore_SendMessageBatch/sends_a_batch_to_a_fifo_queue_with_deduplication (0.01s)
    --- PASS: TestFDBStore_SendMessageBatch/returns_error_if_queue_does_not_exist (0.00s)
    --- PASS: TestFDBStore_SendMessageBatch/handles_partial_failures_within_a_batch (0.01s)
=== RUN   TestFDBStore_FifoQueue_Fairness
    fdb_test.go:710: Received group IDs: [group-a group-b group-c]
--- PASS: TestFDBStore_FifoQueue_Fairness (0.07s)
=== RUN   TestFDBStore_DeleteMessageBatch
=== RUN   TestFDBStore_DeleteMessageBatch/successfully_deletes_a_batch_from_a_standard_queue
=== RUN   TestFDBStore_DeleteMessageBatch/handles_partial_success_in_a_batch
--- PASS: TestFDBStore_DeleteMessageBatch (0.05s)
    --- PASS: TestFDBStore_DeleteMessageBatch/successfully_deletes_a_batch_from_a_standard_queue (0.02s)
    --- PASS: TestFDBStore_DeleteMessageBatch/handles_partial_success_in_a_batch (0.02s)
=== RUN   TestFDBStore_DeleteMessage
=== RUN   TestFDBStore_DeleteMessage/Successful_Deletion
=== RUN   TestFDBStore_DeleteMessage/Non-Existent_Receipt_Handle
=== RUN   TestFDBStore_DeleteMessage/Non-Existent_Queue
=== RUN   TestFDBStore_DeleteMessage/Malformed_Receipt_Handle
=== RUN   TestFDBStore_DeleteMessage/Deleting_from_FIFO_queue_unlocks_message_group
--- PASS: TestFDBStore_DeleteMessage (0.16s)
    --- PASS: TestFDBStore_DeleteMessage/Successful_Deletion (0.12s)
    --- PASS: TestFDBStore_DeleteMessage/Non-Existent_Receipt_Handle (0.00s)
    --- PASS: TestFDBStore_DeleteMessage/Non-Existent_Queue (0.00s)
    --- PASS: TestFDBStore_DeleteMessage/Malformed_Receipt_Handle (0.00s)
    --- PASS: TestFDBStore_DeleteMessage/Deleting_from_FIFO_queue_unlocks_message_group (0.02s)
=== RUN   TestFDBStore_ReceiveMessage
=== RUN   TestFDBStore_ReceiveMessage/Standard_Queue
=== RUN   TestFDBStore_ReceiveMessage/Standard_Queue/Receive_from_empty_queue
=== RUN   TestFDBStore_ReceiveMessage/Standard_Queue/Receive_respects_visibility_timeout
=== RUN   TestFDBStore_ReceiveMessage/Standard_Queue/Long_polling_waits_for_message
=== RUN   TestFDBStore_ReceiveMessage/FIFO_Queue
=== RUN   TestFDBStore_ReceiveMessage/FIFO_Queue/Receive_respects_message_group_lock
=== RUN   TestFDBStore_ReceiveMessage/FIFO_Queue/Receive_with_deduplication_attempt_ID
--- PASS: TestFDBStore_ReceiveMessage (1.53s)
    --- PASS: TestFDBStore_ReceiveMessage/Standard_Queue (1.48s)
        --- PASS: TestFDBStore_ReceiveMessage/Standard_Queue/Receive_from_empty_queue (0.02s)
        --- PASS: TestFDBStore_ReceiveMessage/Standard_Queue/Receive_respects_visibility_timeout (1.23s)
        --- PASS: TestFDBStore_ReceiveMessage/Standard_Queue/Long_polling_waits_for_message (0.23s)
    --- PASS: TestFDBStore_ReceiveMessage/FIFO_Queue (0.05s)
        --- PASS: TestFDBStore_ReceiveMessage/FIFO_Queue/Receive_respects_message_group_lock (0.03s)
        --- PASS: TestFDBStore_ReceiveMessage/FIFO_Queue/Receive_with_deduplication_attempt_ID (0.02s)
=== RUN   TestFDBStore_PurgeQueue
=== RUN   TestFDBStore_PurgeQueue/purges_a_queue_successfully
=== RUN   TestFDBStore_PurgeQueue/returns_error_for_non-existent_queue
=== RUN   TestFDBStore_PurgeQueue/returns_error_if_purged_recently
=== RUN   TestFDBStore_PurgeQueue/purges_a_FIFO_queue_successfully
--- PASS: TestFDBStore_PurgeQueue (0.05s)
    --- PASS: TestFDBStore_PurgeQueue/purges_a_queue_successfully (0.02s)
    --- PASS: TestFDBStore_PurgeQueue/returns_error_for_non-existent_queue (0.00s)
    --- PASS: TestFDBStore_PurgeQueue/returns_error_if_purged_recently (0.01s)
    --- PASS: TestFDBStore_PurgeQueue/purges_a_FIFO_queue_successfully (0.01s)
=== RUN   TestFDBStore_DeleteRecreateIsolation
--- PASS: TestFDBStore_DeleteRecreateIsolation (0.03s)
=== RUN   TestFDBStore_SendMessage
=== RUN   TestFDBStore_SendMessage/sends_a_simple_message_successfully
=== RUN   TestFDBStore_SendMessage/sends_a_message_with_attributes_and_verifies_hash
=== RUN   TestFDBStore_SendMessage/sends_a_message_with_delay
=== RUN   TestFDBStore_SendMessage/sends_a_message_to_a_fifo_queue_and_checks_deduplication
=== RUN   TestFDBStore_SendMessage/returns_error_if_queue_does_not_exist
--- PASS: TestFDBStore_SendMessage (0.04s)
    --- PASS: TestFDBStore_SendMessage/sends_a_simple_message_successfully (0.01s)
    --- PASS: TestFDBStore_SendMessage/sends_a_message_with_attributes_and_verifies_hash (0.01s)
    --- PASS: TestFDBStore_SendMessage/sends_a_message_with_delay (0.01s)
    --- PASS: TestFDBStore_SendMessage/sends_a_message_to_a_fifo_queue_and_checks_deduplication (0.01s)
    --- PASS: TestFDBStore_SendMessage/returns_error_if_queue_does_not_exist (0.00s)
=== RUN   TestFDBStore_ContentBasedDeduplication
--- PASS: TestFDBStore_ContentBasedDeduplication (0.02s)
=== RUN   TestFDBStore_RedrivePolicy
=== RUN   TestFDBStore_RedrivePolicy/Standard_Queue_DLQ
=== RUN   TestFDBStore_RedrivePolicy/FIFO_Queue_DLQ
--- PASS: TestFDBStore_RedrivePolicy (4.07s)
    --- PASS: TestFDBStore_RedrivePolicy/Standard_Queue_DLQ (2.03s)
    --- PASS: TestFDBStore_RedrivePolicy/FIFO_Queue_DLQ (2.03s)
=== RUN   TestFDBStore_QueueTags
--- PASS: TestFDBStore_QueueTags (0.03s)
=== RUN   TestFDBStore_SetQueueAttributes
=== RUN   TestFDBStore_SetQueueAttributes/sets_attributes_on_an_existing_queue
=== RUN   TestFDBStore_SetQueueAttributes/returns_error_for_non-existent_queue
--- PASS: TestFDBStore_SetQueueAttributes (0.02s)
    --- PASS: TestFDBStore_SetQueueAttributes/sets_attributes_on_an_existing_queue (0.00s)
    --- PASS: TestFDBStore_SetQueueAttributes/returns_error_for_non-existent_queue (0.00s)
=== RUN   TestFDBStore_GetQueueAttributes
=== RUN   TestFDBStore_GetQueueAttributes/gets_attributes_for_an_existing_queue
=== RUN   TestFDBStore_GetQueueAttributes/returns_empty_map_for_queue_with_no_attributes
=== RUN   TestFDBStore_GetQueueAttributes/returns_error_for_non-existent_queue
--- PASS: TestFDBStore_GetQueueAttributes (0.02s)
    --- PASS: TestFDBStore_GetQueueAttributes/gets_attributes_for_an_existing_queue (0.01s)
    --- PASS: TestFDBStore_GetQueueAttributes/returns_empty_map_for_queue_with_no_attributes (0.01s)
    --- PASS: TestFDBStore_GetQueueAttributes/returns_error_for_non-existent_queue (0.00s)
=== RUN   TestMessageRetention
=== RUN   TestMessageRetention/StandardQueue_MessageExpires
=== RUN   TestMessageRetention/StandardQueue_MessageDoesNotExpire
=== RUN   TestMessageRetention/FifoQueue_MessageExpires
=== RUN   TestMessageRetention/FifoQueue_MessageDoesNotExpire
--- PASS: TestMessageRetention (4.46s)
    --- PASS: TestMessageRetention/StandardQueue_MessageExpires (2.22s)
    --- PASS: TestMessageRetention/StandardQueue_MessageDoesNotExpire (0.01s)
    --- PASS: TestMessageRetention/FifoQueue_MessageExpires (2.21s)
    --- PASS: TestMessageRetention/FifoQueue_MessageDoesNotExpire (0.01s)
=== RUN   TestConcurrency_ShardSelection
--- PASS: TestConcurrency_ShardSelection (0.25s)
=== RUN   TestProperty_SendMessage_Invariants
--- PASS: TestProperty_SendMessage_Invariants (0.12s)
=== RUN   TestBoundary_BatchOperations
--- PASS: TestBoundary_BatchOperations (0.01s)
=== RUN   TestNegative_InvalidReceiptHandle
--- PASS: TestNegative_InvalidReceiptHandle (0.01s)
=== RUN   TestFuzz_RedrivePolicy
--- PASS: TestFuzz_RedrivePolicy (0.00s)
PASS
coverage: 51.7% of statements in ./...
ok  	github.com/tabeth/concreteq/store	13.738s	coverage: 51.7% of statements in ./...
FAIL
